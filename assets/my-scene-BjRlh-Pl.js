var T=Object.defineProperty;var S=(r,n,t)=>n in r?T(r,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[n]=t;var h=(r,n,t)=>S(r,typeof n!="symbol"?n+"":n,t);import{P as d}from"./phaser-C6ckl6Ka.js";import{l as B}from"./lodash-BkzDGCz7.js";const w=d.Math.Vector2,y=200;class R extends d.Scene{constructor(){super({key:"myscene"});h(this,"balls");h(this,"ball");h(this,"lastBall");h(this,"score");h(this,"scoreText");h(this,"nextBallReady");h(this,"gameOver");h(this,"ballTypes");this.balls=[],this.score=0,this.nextBallReady=!0,this.gameOver=!1,this.ballTypes=[{score:10,size:40,color:16734003},{score:20,size:55,color:49061},{score:30,size:75,color:7291585},{score:30,size:90,color:7291585},{score:50,size:120,color:3066993},{score:70,size:145,color:16761095},{score:140,size:170,color:3447003}]}preload(){["B01","B02","B03","B04","B05","B06","B07"].forEach(t=>{this.load.image(t,`./assets/${t}.png`),console.log(`ロード試行: ${t}.png`)}),this.load.image("effect","/assets/effect.png"),this.load.audio("pop","/assets/pop.mp3"),this.load.audio("bgm",["/assets/audio/takeshi.mp3"]),this.load.image("background","/assets/background-sp.jpg"),this.load.on("filecomplete",(t,e)=>{console.log(`ファイルがロードされました: ${t} (${e})`)}),this.load.on("loaderror",t=>{console.error("ファイルのロードに失敗:",t.src)})}create(){this.add.image(0,0,"background").setOrigin(0,0);const e=10,o=window.innerHeight,a=window.innerWidth*.9,s=(window.innerWidth-a)/2,l=s+a,c=this.sound.add("bgm",{loop:!0});this.input.once("pointerdown",()=>{c.play()}),this.matter.world.setBounds(s,50,a,o);const g=this.matter.add.rectangle(s,o/2+50,e,o,{isStatic:!0});this.matter.world.add(g);const u=this.matter.add.rectangle(l,o/2+50,e,o,{isStatic:!0});this.matter.world.add(u);const i=this.add.graphics({lineStyle:{width:5,color:255}});i.strokeRectShape(new d.Geom.Rectangle(s-e/2,50,e,o)),i.strokeRectShape(new d.Geom.Rectangle(l-e/2,50,e,o)),i.setVisible(!0),i.moveTo(s-10,y),i.lineTo(l+10,y),i.strokePath(),i.setVisible(!0);const m=o-180,x=this.matter.add.rectangle(s+a/2,m+10,a,20,{isStatic:!0});this.matter.world.add(x),i.moveTo(s-10,m),i.lineTo(l+10,m),i.strokePath(),i.setVisible(!1),this.score=0,this.gameOver=!1,this.nextBallReady=!0,this.balls=[],this.scoreText=this.add.text(0,0,`score: ${this.score}`,{fontSize:"45px",color:"#ffffff"}),this.input.on("pointerdown",()=>{this.onClick()}),this.input.on("mousedown",()=>{this.onClick()}),this.ball=this.getBall(s+a/2,100,this.ballTypes[0],"B01",!1),this.setCollision(),this.input.on("pointermove",f=>{var p;if((p=this.ball)!=null&&p.isStatic()){const b=d.Math.Clamp(f.x,s,l);this.ball.x=b}}),this.input.on("mousemove",f=>{var p;if((p=this.ball)!=null&&p.isStatic()){const b=d.Math.Clamp(f.x,s,l);this.ball.x=b}})}getBall(t,e,o,a,s=!1){console.log(`Creating ball with key: ${a}`);const l=this.matter.add.image(t,e,a,void 0,{shape:{type:"circle"},ignorePointer:!0});return l.setDisplaySize(o.size,o.size),l.setCircle(o.size/2),l.setBounce(.2),s&&l.setRotation(B.random(360)),l.setSensor(!0),l.setStatic(!0),l}update(){if(this.ball&&this.ball.isStatic()){let t;t=this.input.mousePointer.x;const e=(window.innerWidth-window.innerWidth*.8)/2+10,o=e+window.innerWidth*.8-10;this.ball.x=d.Math.Clamp(t,e,o)}}setCollision(){this.matter.world.on("collisionstart",t=>{this.gameOver||t.pairs.forEach(e=>{const o=e.bodyA,a=e.bodyB,s=o.gameObject,l=a.gameObject;if(o.label!=="Circle Body"||a.label!=="Circle Body"||!s||!l||s.isStatic()||l.isStatic())return;const c=Math.round(s.displayWidth),g=Math.round(l.displayWidth);if(c===g){if(c===this.ballTypes[this.ballTypes.length-1].size){const i=this.add.sprite(s.x,s.y,"effect");i.setScale(.5),this.sound.add("pop").play(),this.tweens.add({targets:i,alpha:0,duration:700,onComplete:()=>{i.destroy()}})}const u=this.ballTypes.find(i=>i.size===c);if(u&&(this.score+=u.score,this.scoreText.setText(`score: ${this.score}`)),s.destroy(),l.destroy(),this.time.delayedCall(20,()=>{this.balls.filter(i=>i.active&&i!==this.lastBall).forEach(i=>{i.applyForce(new w(0,.01))})}),c!==this.ballTypes[this.ballTypes.length-1].size){const i=k(o,a);this.makeNewBall(i.x,i.y,c)}}else(s===this.lastBall||l===this.lastBall)&&this.lastBall.y<y&&(this.gameOver=!0,this.drawGameOverTexts());this.ball!==s&&this.ball!==l&&(s===this.lastBall||l===this.lastBall)&&(this.nextBallReady=!0)})})}onClick(){if(!this.nextBallReady||this.gameOver)return;this.nextBallReady=!1;const t=this.ball;this.applyPhysicsToBall(t),this.lastBall=t;const e=B.random(0,4),o=this.ballTypes[e],a=["B01","B02","B03","B04","B05"][e];this.ball=this.getBall(window.innerWidth/2,100,o,a,!1),this.nextBallReady=!0}makeNewBall(t,e,o){const a=this.ballTypes.findIndex(s=>s.size===o)+1;if(a<this.ballTypes.length){const s=this.ballTypes[a],l=["B01","B02","B03","B04","B05","B06","B07"][a],c=this.getBall(t,e,s,l,!0);this.applyPhysicsToBall(c,!0)}}applyPhysicsToBall(t,e=!1){t.setSensor(!1),t.setStatic(!1),t.setBounce(.5),t.applyForce(new w(0,e?-.1:.01)),this.balls.push(t)}drawGameOverTexts(){const t=window.innerWidth/2,e=`GAMEOVER
score: ${this.score}`;this.add.text(t,300,e,{fontSize:20,color:"black",backgroundColor:"#FFF"}).setOrigin(.5);const o=window.innerWidth/2,a=this.add.text(o,400,"RETRY",{fontSize:"32px",color:"black",backgroundColor:"#FFF"});a.setOrigin(.5),a.on("pointerdown",()=>{this.scene.restart()}),a.setInteractive()}}function k(r,n){const t=(r.position.x+n.position.x)/2,e=(r.position.y+n.position.y)/2;return{x:t,y:e}}export{R as M};
